This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
app/favicon.ico
app/globals.css
app/layout.tsx
app/page.tsx
components/marketplace/RuleCard.tsx
eslint.config.mjs
LICENSE
next.config.ts
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
tailwind.config.ts
tsconfig.json
types/rule.ts
wasm-core/Cargo.toml
wasm-core/src/engine.rs
wasm-core/src/lib.rs
wasm-core/src/rules.rs
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/globals.css">
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}
</file>

<file path="components/marketplace/RuleCard.tsx">
"use client"

import { Download, User, Hash, ShieldCheck } from "lucide-react";

interface RuleCardProps {
  rule: CommunityRule;
}

import { CommunityRule } from "@/types/rule";

export default function RuleCard({ rule }: RuleCardProps) {
  // æ„å»ºä¸€é”®å¯¼å…¥çš„ Deep Link
  const importUrl = `safemask://import?name=${encodeURIComponent(rule.name)}&pattern=${encodeURIComponent(rule.pattern)}&mask=${encodeURIComponent(rule.mask)}&priority=${rule.priority}`;

  return (
    <div className="group relative p-6 rounded-2xl bg-zinc-900/30 border border-white/[0.05] hover:border-amber-500/30 transition-all duration-500 overflow-hidden">
      {/* é¡¶éƒ¨ä¿¡æ¯ */}
      <div className="flex justify-between items-start mb-4">
        <div className="space-y-1">
          <h3 className="text-lg font-bold text-amber-50/90 group-hover:text-amber-400 transition-colors">
            {rule.name}
          </h3>
          <div className="flex items-center gap-2 text-[10px] text-zinc-500 font-bold uppercase tracking-widest">
            <User size={10} /> {rule.author}
          </div>
        </div>
        <div className="px-2 py-1 rounded bg-amber-500/10 border border-amber-500/20 text-[9px] font-black text-amber-500 uppercase">
          {rule.category}
        </div>
      </div>

      {/* è§„åˆ™æè¿° */}
      <p className="text-xs text-zinc-500 line-clamp-2 mb-6 h-8 italic leading-relaxed">
        "{rule.description}"
      </p>

      {/* æ­£åˆ™é¢„è§ˆåŒº - æ¨¡æ‹Ÿç²¾å¯†ä»ªè¡¨ç›˜ */}
      <div className="relative mb-6 p-3 rounded-xl bg-black/40 border border-white/[0.03] shadow-inner overflow-hidden">
        <code className="text-[11px] font-mono text-zinc-400 truncate block">
          {rule.pattern}
        </code>
        <div className="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-black/80 to-transparent flex items-center justify-end pr-2">
          <Hash size={12} className="text-zinc-700" />
        </div>
      </div>

      {/* åº•éƒ¨æ“ä½œåŒº */}
      <div className="flex items-center justify-between">
        <div className="flex flex-col">
          <span className="text-[8px] text-zinc-600 font-black uppercase tracking-tighter">Mask Label</span>
          <span className="text-xs font-mono font-bold text-blue-400/80">{rule.mask}</span>
        </div>

        <a 
          href={importUrl}
          className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-black rounded-xl text-[11px] font-black uppercase tracking-widest hover:bg-amber-400 active:scale-95 transition-all shadow-lg shadow-amber-900/20"
        >
          <Download size={14} strokeWidth={3} /> ä¸€é”®å¯¼å…¥
        </a>
      </div>

      {/* èƒŒæ™¯è£…é¥°æ•ˆæœ */}
      <div className="absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 transition-opacity duration-700">
        <ShieldCheck size={80} />
      </div>
    </div>
  );
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2026 xiao sheng

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="package.json">
{
  "name": "safemask-hub",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "lucide-react": "^0.575.0",
    "next": "16.1.6",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss";

const config: Config = {
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        // ğŸš€ æ¬è¿ SafeMask æ ‡å¿—æ€§çš„ç¥ç€é»‘
        background: "#0c0b0a", 
        foreground: "#fffbeb", // amber-50
        panel: "#0d0d0f",
      },
      // ğŸš€ æ¬è¿ä½ ä¹‹å‰çš„ 4.5 é—´è·
      spacing: {
        '4.5': '1.125rem',
      }
    },
  },
  plugins: [],
};
export default config;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="types/rule.ts">
export interface RuleCategory {
  id: string;
  label: string;
  icon: string;
}

export interface CommunityRule {
  id: string;
  name: string;
  author: string;
  category: string;
  pattern: string;
  mask: string;
  priority: number;
  downloads: number;
  description: string;
}
</file>

<file path="wasm-core/Cargo.toml">
[package]
name = "safemask-wasm"
version = "0.1.0"
edition = "2021"

[lib]
# ğŸš€ å¿…é¡»å£°æ˜ä¸º cdylibï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆ .wasm æ–‡ä»¶
crate_type = ["cdylib"]

[dependencies]
# WASM æ ¸å¿ƒæ¡¥æ¢
wasm-bindgen = "0.2"
js-sys = "0.3"

# åºåˆ—åŒ–ï¼ˆç”¨äºåœ¨ JS å’Œ Rust ä¹‹é—´ä¼ é€’å¤æ‚çš„è§„åˆ™å¯¹è±¡ï¼‰
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# ğŸš€ ä¿æŒç®—æ³•åº“ç‰ˆæœ¬ä¸æ¡Œé¢ç«¯ä¸€è‡´
regex = "1.10"
aho-corasick = "1.1"
smallvec = { version = "1.11", features = ["serde"] }

# è¾…åŠ©ï¼šæŸ¥çœ‹ WASM å†…éƒ¨æŠ¥é”™ï¼ˆå¯é€‰ï¼Œå»ºè®®åŠ ä¸Šï¼‰
console_error_panic_hook = "0.1.7"
</file>

<file path="wasm-core/src/engine.rs">
use crate::core::rules::Rule;
use aho_corasick::{AhoCorasick, MatchKind};
use regex::bytes::{Regex};
use std::borrow::Cow;
use smallvec::SmallVec;
use log::{info};  // æ·»åŠ å¯¼å…¥

const LITERAL_PRIORITY: i32 = 999_000_000;  // è¿œé«˜äºæ™®é€šè§„åˆ™

/// å†…éƒ¨ç»“æ„ï¼šå­˜å‚¨ç¼–è¯‘åçš„å•ä¸ªæ­£åˆ™è§„åˆ™
struct CompiledRegex {
    re: Regex,
    mask: Vec<u8>,
    priority: i32,
}

/// åŒ¹é…ç‰‡æ®µè®°å½•ï¼šç”¨äºå†²çªåˆå¹¶
struct MatchSpan<'m> {
    start: usize,
    end: usize,
    priority: i32,
    mask: &'m [u8],
}

pub struct MaskEngine {
    /// è¯å…¸å¼•æ“ï¼šå¤„ç†å›ºå®šå­—ç¬¦ä¸²
    ac_engine: Option<AhoCorasick>,
    ac_masks: Vec<Vec<u8>>,
    
    /// æ­£åˆ™å¼•æ“åˆ—è¡¨ï¼šæŒ‰ä¼˜å…ˆçº§æ’åº
    regex_rules: Vec<CompiledRegex>,
}

impl MaskEngine {
    /// æ„é€ å¼•æ“ï¼šè‡ªåŠ¨åˆ†ç±»è§„åˆ™å¹¶é¢„ç¼–è¯‘
    pub fn new(mut rules: Vec<Rule>) -> Self {
        info!("âš™ï¸ å¼•æ“æ„å»ºå¼€å§‹ï¼Œè§„åˆ™æ•°: {}", rules.len());
        // 1. è¿‡æ»¤æœªå¯ç”¨çš„è§„åˆ™å¹¶æŒ‰ä¼˜å…ˆçº§é™åºæ’åˆ—
        rules.retain(|r| r.enabled);
        rules.sort_by(|a, b| b.priority.cmp(&a.priority));

        let mut ac_patterns = Vec::new();
        let mut ac_masks = Vec::new();
        let mut regex_rules = Vec::new();

        for rule in rules {
            if is_literal(&rule.pattern) {
                // å›ºå®šè¯æ”¾å…¥ AC å¼•æ“
                ac_patterns.push(rule.pattern);
                ac_masks.push(rule.mask.as_bytes().to_vec());
            } else {
                // æ­£åˆ™è¡¨è¾¾å¼é¢„ç¼–è¯‘
                if let Ok(re) = Regex::new(&rule.pattern) {
                    regex_rules.push(CompiledRegex {
                        re,
                        mask: rule.mask.as_bytes().to_vec(),
                        priority: rule.priority,
                    });
                } else {
                    eprintln!("âš ï¸ [Engine] å¿½ç•¥æ— æ•ˆæ­£åˆ™: {}", rule.name);
                }
            }
        }

        let ac_engine = if ac_patterns.is_empty() {
            None
        } else {
            AhoCorasick::builder()
                .match_kind(MatchKind::LeftmostLongest)
                .build(ac_patterns)
                .ok()
        };

        Self {
            ac_engine,
            ac_masks,
            regex_rules,
        }
    }

    /// æ ¸å¿ƒæ–¹æ³•ï¼šå¯¹å•è¡Œå­—èŠ‚æµè¿›è¡Œè„±æ•
    pub fn mask_line<'a>(&self, input: &'a [u8]) -> Cow<'a, [u8]> {
        if input.is_empty() {
            return Cow::Borrowed(input);
        }

        // ğŸš€ ä½¿ç”¨ SmallVec ä¼˜åŒ–ï¼šé¢„ç•™ 16 ä¸ªæ’æ§½åœ¨æ ˆä¸Šï¼Œè¦†ç›– 99% çš„å•è¡ŒåŒ¹é…åœºæ™¯
        let mut matches: SmallVec<[MatchSpan; 16]> = SmallVec::new();

        // Stage 1: AC è‡ªåŠ¨æœºåŒ¹é… (å›ºå®šè¯)
        if let Some(ref ac) = self.ac_engine {
            for mat in ac.find_iter(input) {
                matches.push(MatchSpan {
                    start: mat.start(),
                    end: mat.end(),
                    priority: LITERAL_PRIORITY, // å›ºå®šè¯é€šå¸¸æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§
                    mask: &self.ac_masks[mat.pattern()],
                });
            }
        }

        // Stage 2: æ­£åˆ™åŒ¹é…
        for rule in &self.regex_rules {
            for mat in rule.re.find_iter(input) {
                matches.push(MatchSpan {
                    start: mat.start(),
                    end: mat.end(),
                    priority: rule.priority,
                    mask: &rule.mask,
                });
            }
        }

        if matches.is_empty() {
            return Cow::Borrowed(input);
        }

        // Stage 3: å†²çªè§£å†³ä¸ç»“æœåˆå¹¶ (å…³è”å‡½æ•°è°ƒç”¨)
        self.apply_replacements(input, matches)
    }

    /// è§£å†³è¦†ç›–å†²çªï¼šé‡‡ç”¨è´ªå©ªåˆå¹¶ç­–ç•¥
    fn apply_replacements<'a, 'm, I>(
        &self,
        input: &'a [u8],
        matches: I,
    ) -> Cow<'a, [u8]>
    where
        I: IntoIterator<Item = MatchSpan<'m>>,
    {
        // å¦‚æœä½ è¿˜éœ€è¦æ’åºå’Œå»é‡ï¼Œå°±å¿…é¡»å…ˆæ”¶é›†
        let mut matches: Vec<MatchSpan<'m>> = matches.into_iter().collect();
        // ä¸‹é¢æ’åº
        matches.sort_unstable_by(|a, b| {
            a.start.cmp(&b.start)
                .then(b.priority.cmp(&a.priority))
                .then((b.end - b.start).cmp(&(a.end - a.start)))
        });

        let mut output = Vec::with_capacity(input.len());
        let mut last_pos = 0;

        for m in matches {
            if m.start < last_pos {
                continue;
            }
            output.extend_from_slice(&input[last_pos..m.start]);
            output.extend_from_slice(m.mask);
            last_pos = m.end;
        }

        if last_pos < input.len() {
            output.extend_from_slice(&input[last_pos..]);
        }

        Cow::Owned(output)
    }
}

/// è¾…åŠ©å‡½æ•°ï¼šæ£€æµ‹æ˜¯å¦ä¸ºå›ºå®šè¯ï¼ˆæ— æ­£åˆ™ç‰¹æ®Šç¬¦å·ï¼‰
fn is_literal(pattern: &str) -> bool {
    let meta = ['.', '+', '*', '?', '(', ')', '|', '[', ']', '{', '}', '^', '$', '\\'];
    !pattern.chars().any(|c| meta.contains(&c))
}
</file>

<file path="wasm-core/src/lib.rs">
mod engine;
mod rules;

use wasm_bindgen::prelude::*;
use crate::engine::MaskEngine;
use crate::rules::Rule;

#[wasm_bindgen]
pub struct SafeMaskWasm {
    engine: MaskEngine,
}

#[wasm_bindgen]
impl SafeMaskWasm {
    /// ğŸš€ æ„é€ å‡½æ•°ï¼šJS ä¼ å…¥ JSON æ ¼å¼çš„è§„åˆ™æ•°ç»„
    #[wasm_bindgen(constructor)]
    pub fn new(rules_json: &str) -> Result<SafeMaskWasm, JsValue> {
        // 1. è®¾ç½® panic hookï¼ˆè¿™æ · Rust æŠ¥é”™ä¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºï¼‰
        console_error_panic_hook::set_once();

        // 2. è§£æè§„åˆ™
        let rules: Vec<Rule> = serde_json::from_str(rules_json)
            .map_err(|e| JsValue::from_str(&format!("JSON è§£æå¤±è´¥: {}", e)))?;

        // 3. åˆå§‹åŒ–å¼•æ“
        Ok(SafeMaskWasm {
            engine: MaskEngine::new(rules),
        })
    }

    /// ğŸš€ è„±æ•æ¨¡æ‹Ÿï¼šJS ä¼ å…¥æ–‡æœ¬ï¼Œè¿”å›è„±æ•åçš„ç»“æœ
    pub fn mask(&self, input: &str) -> String {
        let result = self.engine.mask_line(input.as_bytes());
        String::from_utf8_lossy(&result).to_string()
    }
}
</file>

<file path="wasm-core/src/rules.rs">
use serde::{Deserialize, Serialize};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Rule {
    /// è§„åˆ™åç§° (å”¯ä¸€æ ‡è¯†)
    pub name: String,
    
    /// æ­£åˆ™è¡¨è¾¾å¼æˆ–å…³é”®å­—
    pub pattern: String,
    
    /// æ›¿æ¢æ©ç  (ä¾‹å¦‚: <EMAIL>)
    pub mask: String,
    
    /// ä¼˜å…ˆçº§ (æ•°å­—è¶Šå¤§è¶Šå…ˆå¤„ç†)
    #[serde(default)]
    pub priority: i32,
    
    /// æ˜¯å¦å¯ç”¨
    #[serde(default = "default_true")]
    pub enabled: bool,

    /// æ˜¯å¦ä¸ºç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™ (å½±å“ UI æ˜¾ç¤ºå’Œå­˜å‚¨ä½ç½®)
    #[serde(default)]
    pub is_custom: bool,
}

fn default_true() -> bool {
    true
}

/// ç”¨äº YAML å­˜å‚¨çš„åŒ…è£…ç»“æ„
#[derive(Debug, Serialize, Deserialize)]
pub struct RuleGroup {
    pub group: String,
    pub rules: Vec<Rule>,
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="app/page.tsx">
"use client"

import { Shield, ChevronRight, Github, LayoutGrid, Zap, Filter } from "lucide-react";
import RuleCard from "@/components/marketplace/RuleCard";
import { CommunityRule } from "@/types/rule";

// é™æ€æ¨¡æ‹Ÿæ•°æ® - æœªæ¥é€šè¿‡ Go åç«¯è·å–
const MOCK_RULES: CommunityRule[] = [
  {
    id: "1",
    name: "OpenAI Pro Key",
    author: "XiaoSheng",
    category: "AI_API",
    pattern: "sk-proj-[a-zA-Z0-9]{32,}",
    mask: "<OPENAI_KEY>",
    priority: 80,
    downloads: 1240,
    description: "é€‚é… OpenAI æœ€æ–°çš„ Project çº§åˆ« API Key è¯†åˆ«é€»è¾‘ã€‚"
  },
  {
    id: "2",
    name: "IPv4_Full_Range",
    author: "SysAdmin",
    category: "Network",
    pattern: "\\b(?:(?:25[0-5]|2[0-4]\\d|1?\\d{1,2})\\.){3}(?:25[0-5]|2[0-4]\\d|1?\\d{1,2})\\b",
    mask: "<IPv4>",
    priority: 50,
    downloads: 850,
    description: "å·¥ä¸šçº§æ ‡å‡†çš„ IPv4 å…¨æ®µè¯†åˆ«æ­£åˆ™ï¼Œé˜²ç‰ˆæœ¬å·è¯¯è§¦ã€‚"
  },
  {
    id: "3",
    name: "MySQL_URI",
    author: "DBA_Master",
    category: "Database",
    pattern: "mysql(?:\\+.+)?://[^\\s'\"<>]+",
    mask: "<MYSQL_CONNECTION>",
    priority: 90,
    downloads: 2100,
    description: "ç²¾å‡†è¯†åˆ«æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œä¿æŠ¤æ•æ„Ÿçš„ host å’Œå¯†ç ã€‚"
  }
];

export default function Home() {
  return (
    <main className="min-h-screen bg-background text-foreground selection:bg-amber-500/30">
      {/* é¡¶éƒ¨èƒŒæ™¯è£…é¥°å…‰ */}
      <div className="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-6xl h-[500px] bg-amber-500/[0.03] blur-[120px] pointer-events-none" />

      {/* å¯¼èˆªæ  */}
      <nav className="max-w-7xl mx-auto px-12 h-24 flex items-center justify-between relative z-10 border-b border-white/[0.02]">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-xl bg-zinc-900 border border-amber-500/20 flex items-center justify-center shadow-2xl">
            <Shield size={20} className="text-amber-500" />
          </div>
          <div className="flex flex-col">
            <span className="font-black tracking-tighter text-xl leading-none">SafeMask Hub</span>
            <span className="text-[8px] font-black text-amber-500/50 uppercase tracking-[0.3em] mt-1">Rule Ecosystem</span>
          </div>
        </div>
        <div className="flex items-center gap-8">
          <a href="#" className="text-[11px] font-black uppercase tracking-widest text-zinc-500 hover:text-amber-200 transition-colors">Marketplace</a>
          <a href="#" className="text-[11px] font-black uppercase tracking-widest text-zinc-500 hover:text-amber-200 transition-colors">Rewards</a>
          <button className="px-6 py-2.5 bg-amber-500 text-black rounded-xl text-[11px] font-black uppercase tracking-widest hover:bg-amber-400 transition-all shadow-xl shadow-amber-900/10">
            Sign In
          </button>
        </div>
      </nav>

      {/* Hero Section */}
      <section className="max-w-7xl mx-auto px-12 pt-24 pb-12 relative z-10">
        <div className="max-w-3xl">
          <h1 className="text-5xl md:text-7xl font-black tracking-tighter mb-6 bg-gradient-to-br from-amber-50 via-amber-50 to-amber-500/30 bg-clip-text text-transparent">
            èµ‹äºˆ AI å®‰å…¨çš„<br />â€œè§†è§‰â€ç•Œé™
          </h1>
          <p className="text-md text-zinc-500 max-w-xl mb-10 leading-relaxed font-medium">
            SafeMask Hub æ˜¯å…¨çƒé¦–ä¸ªä¸“æ³¨äº AI è¯­ä¹‰å‹å¥½çš„è„±æ•è§„åˆ™å¸‚åœºã€‚åœ¨è¿™é‡Œè´¡çŒ®ä½ çš„æ™ºæ…§ï¼Œä¸ä»…æ˜¯ä¿æŠ¤éšç§ï¼Œæ›´æ˜¯åœ¨æ„å»ºæ›´å¯é çš„äººæœºåä½œåŸºçŸ³ã€‚
          </p>
          <div className="flex items-center gap-4">
            <button className="px-8 py-4 bg-amber-500 text-black rounded-2xl font-black uppercase tracking-widest text-[11px] flex items-center gap-3 hover:bg-amber-400 transition-all">
              å¼€å§‹è´¡çŒ® <Zap size={14} fill="currentColor" />
            </button>
            <div className="flex items-center gap-6 ml-4">
              <div className="flex flex-col">
                <span className="text-lg font-mono font-bold leading-none">2,400+</span>
                <span className="text-[9px] font-black text-zinc-600 uppercase mt-1">Rules Live</span>
              </div>
              <div className="w-px h-6 bg-zinc-800" />
              <div className="flex flex-col">
                <span className="text-lg font-mono font-bold leading-none">150k+</span>
                <span className="text-[9px] font-black text-zinc-600 uppercase mt-1">Imports</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* ğŸš€ è§„åˆ™å¹¿åœºåŒºåŸŸ */}
      <section className="max-w-7xl mx-auto px-12 py-12 relative z-10">
        <div className="flex items-center justify-between mb-10 border-b border-white/[0.02] pb-6">
          <div className="flex items-center gap-3">
            <LayoutGrid size={18} className="text-amber-500/50" />
            <h2 className="text-sm font-black uppercase tracking-[0.2em] text-zinc-400">ç²¾é€‰è§„åˆ™å¸‚åœº</h2>
          </div>
          <div className="flex items-center gap-4">
             <button className="flex items-center gap-2 text-[10px] font-black text-zinc-500 hover:text-amber-400 transition-all uppercase">
               <Filter size={12} /> Filter
             </button>
          </div>
        </div>

        {/* è§„åˆ™ç½‘æ ¼å¸ƒå±€ */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {MOCK_RULES.map(rule => (
            <RuleCard key={rule.id} rule={rule} />
          ))}
        </div>
      </section>

      {/* æç®€é¡µè„š */}
      <footer className="max-w-7xl mx-auto px-12 py-20 opacity-20 text-center">
        <p className="text-[9px] font-mono uppercase tracking-[0.6em]">
          SafeMask Hub Â· Empowering Private Intelligence
        </p>
      </footer>
    </main>
  );
}
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

</files>
